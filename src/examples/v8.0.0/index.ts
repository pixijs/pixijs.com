import collisionDetection from '!!raw-loader!./advanced/collisionDetection.js';
import mouseTrail from '!!raw-loader!./advanced/mouseTrail.js';
import scratchCard from '!!raw-loader!./advanced/scratchCard.js';
import screenShot from '!!raw-loader!./advanced/screenShot.js';
import slots from '!!raw-loader!./advanced/slots.js';
import spinners from '!!raw-loader!./advanced/spinners/index.js';
import spinnersIntersect from '!!raw-loader!./advanced/spinners/intersect.js';
import spinnerGenerator1 from '!!raw-loader!./advanced/spinners/spinner1.js';
import spinnerGenerator2 from '!!raw-loader!./advanced/spinners/spinner2.js';
import spinnerGenerator3 from '!!raw-loader!./advanced/spinners/spinner3.js';
import spinnerGenerator4 from '!!raw-loader!./advanced/spinners/spinner4.js';
import spinnerGenerator5 from '!!raw-loader!./advanced/spinners/spinner5.js';
import starWarp from '!!raw-loader!./advanced/starWarp.js';

import async from '!!raw-loader!./assets/async.js';
import background from '!!raw-loader!./assets/background.js';
import bundle from '!!raw-loader!./assets/bundle.js';
import multiple from '!!raw-loader!./assets/multiple.js';
import promise from '!!raw-loader!./assets/promise.js';

import blendModes from '!!raw-loader!./basic/blendModes.js';
import container from '!!raw-loader!./basic/container.js';
import particleContainer from '!!raw-loader!./basic/particleContainer.js';
import meshPlane from '!!raw-loader!./basic/meshPlane.js';
import tinting from '!!raw-loader!./basic/tinting.js';
import transparentBackground from '!!raw-loader!./basic/transparentBackground.js';
import fillGradient from '!!raw-loader!./basic/fillGradient.js';

import click from '!!raw-loader!./events/click.js';
import customHitarea from '!!raw-loader!./events/customHitarea.js';
import customMouseIcon from '!!raw-loader!./events/customMouseIcon.js';
import dragging from '!!raw-loader!./events/dragging.js';
import hitTestingWithSpatialHash from '!!raw-loader!./events/hitTestingWithSpatialHash.js';
import interactivity from '!!raw-loader!./events/interactivity.js';
import logger from '!!raw-loader!./events/logger.js';
import pointerTracker from '!!raw-loader!./events/pointerTracker.js';
import slider from '!!raw-loader!./events/slider.js';

import custom from '!!raw-loader!./filtersAdvanced/custom/index.js';
import customVert from '!!raw-loader!./filtersAdvanced/custom/custom.vert';
import customFrag from '!!raw-loader!./filtersAdvanced/custom/custom.frag';
import mouseBlending from '!!raw-loader!./filtersAdvanced/mouseBlending/index.js';
import mouseBlendingVert from '!!raw-loader!./filtersAdvanced/mouseBlending/mouseBlending.vert';
import mouseBlendingFrag from '!!raw-loader!./filtersAdvanced/mouseBlending/mouseBlending.frag';

import blur from '!!raw-loader!./filtersBasic/blur.js';
import colorMatrix from '!!raw-loader!./filtersBasic/colorMatrix.js';
import displacementMapCrawlies from '!!raw-loader!./filtersBasic/displacementMapCrawlies.js';
import displacementMapFlag from '!!raw-loader!./filtersBasic/displacementMapFlag.js';

import advanced from '!!raw-loader!./graphics/advanced.js';
import dynamic from '!!raw-loader!./graphics/dynamic.js';
import simple from '!!raw-loader!./graphics/simple.js';

import filter from '!!raw-loader!./masks/filter.js';
import graphics from '!!raw-loader!./masks/graphics.js';
import sprite from '!!raw-loader!./masks/sprite.js';

import instancedGeometry from '!!raw-loader!./meshAndShaders/instancedGeometry/index.js';
import instancedGeometryVert from '!!raw-loader!./meshAndShaders/instancedGeometry/instancedGeometry.vert';
import instancedGeometryFrag from '!!raw-loader!./meshAndShaders/instancedGeometry/instancedGeometry.frag';
import instancedGeometryWgsl from '!!raw-loader!./meshAndShaders/instancedGeometry/instancedGeometry.wgsl';
import multipassMesh from '!!raw-loader!./meshAndShaders/multipassMesh/index.js';
import multipassMeshVert from '!!raw-loader!./meshAndShaders/multipassMesh/multipassMesh.vert';
import multipassMeshGridFrag from '!!raw-loader!./meshAndShaders/multipassMesh/grid.frag';
import multipassMeshRippleFrag from '!!raw-loader!./meshAndShaders/multipassMesh/ripple.frag';
import multipassMeshNoiseFrag from '!!raw-loader!./meshAndShaders/multipassMesh/noise.frag';
import multipassMeshWaveFrag from '!!raw-loader!./meshAndShaders/multipassMesh/wave.frag';
import multipassMeshCombineFrag from '!!raw-loader!./meshAndShaders/multipassMesh/combine.frag';
import shaderToyMesh from '!!raw-loader!./meshAndShaders/shaderToyMesh/index.js';
import shaderToyMeshVert from '!!raw-loader!./meshAndShaders/shaderToyMesh/shaderToy.vert';
import shaderToyMeshFrag from '!!raw-loader!./meshAndShaders/shaderToyMesh/shaderToy.frag';
import sharedShader from '!!raw-loader!./meshAndShaders/sharedShader/index.js';
import sharedShaderVert from '!!raw-loader!./meshAndShaders/sharedShader/sharedShader.vert';
import sharedShaderFrag from '!!raw-loader!./meshAndShaders/sharedShader/sharedShader.frag';
import sharedGeometry from '!!raw-loader!./meshAndShaders/sharedGeometry/index.js';
import sharedGeometryVert from '!!raw-loader!./meshAndShaders/sharedGeometry/sharedGeometry.vert';
import sharedGeometryFrag from '!!raw-loader!./meshAndShaders/sharedGeometry/sharedGeometry.frag';
import texturedMeshAdvanced from '!!raw-loader!./meshAndShaders/texturedMeshAdvanced.js';
import texturedMeshBasic from '!!raw-loader!./meshAndShaders/texturedMeshBasic.js';
import triangleColor from '!!raw-loader!./meshAndShaders/triangleColor/index.js';
import triangleColorVert from '!!raw-loader!./meshAndShaders/triangleColor/triangleColor.vert';
import triangleColorFrag from '!!raw-loader!./meshAndShaders/triangleColor/triangleColor.frag';
import triangleColorWgsl from '!!raw-loader!./meshAndShaders/triangleColor/triangleColor.wgsl';
import triangleTextured from '!!raw-loader!./meshAndShaders/triangleTextured/index.js';
import triangleTexturedVert from '!!raw-loader!./meshAndShaders/triangleTextured/triangleTextured.vert';
import triangleTexturedFrag from '!!raw-loader!./meshAndShaders/triangleTextured/triangleTextured.frag';
import triangle from '!!raw-loader!./meshAndShaders/triangle/index.js';
import triangleVert from '!!raw-loader!./meshAndShaders/triangle/triangle.vert';
import triangleFrag from '!!raw-loader!./meshAndShaders/triangle/triangle.frag';
import triangleWgsl from '!!raw-loader!./meshAndShaders/triangle/triangle.wgsl';

import offscreenCanvasBasic from '!!raw-loader!./offscreenCanvas/basic.js';
import webWorker from '!!raw-loader!./offscreenCanvas/webWorker.js';

import animatedSpriteAnimationSpeed from '!!raw-loader!./sprite/animatedSpriteAnimationSpeed.js';
import animatedSpriteExplosion from '!!raw-loader!./sprite/animatedSpriteExplosion.js';
import animatedSpriteJet from '!!raw-loader!./sprite/animatedSpriteJet.js';
import spriteBasic from '!!raw-loader!./sprite/basic.js';
import textureSwap from '!!raw-loader!./sprite/textureSwap.js';
import tilingSprite from '!!raw-loader!./sprite/tilingSprite.js';
import video from '!!raw-loader!./sprite/video.js';

import bitmapText from '!!raw-loader!./text/bitmapText.js';
import fromFont from '!!raw-loader!./text/fromFont.js';
import pixiText from '!!raw-loader!./text/pixiText.js';
import webFont from '!!raw-loader!./text/webFont.js';

import renderTextureAdvanced from '!!raw-loader!./textures/renderTextureAdvanced.js';
import renderTextureBasic from '!!raw-loader!./textures/renderTextureBasic.js';
import textureRotate from '!!raw-loader!./textures/textureRotate.js';
import type { Option } from '@site/src/components/Select';

// Defines order of examples in documentation and playground dropdown, it's defined
// separately here so it can be used in runtime code and in the md generation script
import examplesData from './examplesData.json';
import { camelCaseToSentenceCase } from '@site/src/utils/utils';
import type { CategoryDataType, ExampleDataEntry, ExamplesDataType, ExamplesJsonType, ExamplesSourceType } from '..';

const examplesSource: ExamplesSourceType = {
    basic: {
        blendModes,
        container,
        particleContainer,
        meshPlane,
        tinting,
        transparentBackground,
        fillGradient,
    },
    sprite: {
        animatedSpriteAnimationSpeed,
        animatedSpriteExplosion,
        animatedSpriteJet,
        basic: spriteBasic,
        textureSwap,
        tilingSprite,
        video,
    },
    text: {
        bitmapText,
        fromFont,
        pixiText,
        webFont,
    },
    graphics: {
        advanced,
        dynamic,
        simple,
    },
    events: {
        click,
        customHitarea,
        customMouseIcon,
        dragging,
        hitTestingWithSpatialHash,
        interactivity,
        logger,
        pointerTracker,
        slider,
    },
    masks: {
        filter,
        graphics,
        sprite,
    },
    textures: {
        renderTextureAdvanced,
        renderTextureBasic,
        textureRotate,
    },
    assets: {
        async,
        background,
        bundle,
        multiple,
        promise,
    },
    offscreenCanvas: {
        basic: offscreenCanvasBasic,
        webWorker,
    },
    filtersBasic: {
        blur,
        colorMatrix,
        displacementMapCrawlies,
        displacementMapFlag,
    },
    filtersAdvanced: {
        custom: {
            index: custom,
            'src/custom.vert': customVert,
            'src/custom.frag': customFrag,
        },
        mouseBlending: {
            index: mouseBlending,
            'src/mouseBlending.vert': mouseBlendingVert,
            'src/mouseBlending.frag': mouseBlendingFrag,
        },
    },
    advanced: {
        collisionDetection,
        mouseTrail,
        scratchCard,
        screenShot,
        slots,
        spinners: {
            index: spinners,
            'src/spinner1.js': spinnerGenerator1,
            'src/spinner2.js': spinnerGenerator2,
            'src/spinner3.js': spinnerGenerator3,
            'src/spinner4.js': spinnerGenerator4,
            'src/spinner5.js': spinnerGenerator5,
            'src/intersect.js': spinnersIntersect,
        },
        starWarp,
    },
    meshAndShaders: {
        instancedGeometry: {
            index: instancedGeometry,
            'src/instancedGeometry.vert': instancedGeometryVert,
            'src/instancedGeometry.frag': instancedGeometryFrag,
            'src/instancedGeometry.wgsl': instancedGeometryWgsl,
        },
        multipassMesh: {
            index: multipassMesh,
            'src/multipassMesh.vert': multipassMeshVert,
            'src/grid.frag': multipassMeshGridFrag,
            'src/ripple.frag': multipassMeshRippleFrag,
            'src/noise.frag': multipassMeshNoiseFrag,
            'src/wave.frag': multipassMeshWaveFrag,
            'src/combine.frag': multipassMeshCombineFrag,
        },
        shaderToyMesh: {
            index: shaderToyMesh,
            'src/shaderToy.vert': shaderToyMeshVert,
            'src/shaderToy.frag': shaderToyMeshFrag,
        },
        sharedShader: {
            index: sharedShader,
            'src/sharedShader.vert': sharedShaderVert,
            'src/sharedShader.frag': sharedShaderFrag,
        },
        sharedGeometry: {
            index: sharedGeometry,
            'src/sharedGeometry.vert': sharedGeometryVert,
            'src/sharedGeometry.frag': sharedGeometryFrag,
        },
        texturedMeshAdvanced,
        texturedMeshBasic,
        triangleColor: {
            index: triangleColor,
            'src/triangleColor.vert': triangleColorVert,
            'src/triangleColor.frag': triangleColorFrag,
            'src/triangleColor.wgsl': triangleColorWgsl,
        },
        triangleTextured: {
            index: triangleTextured,
            'src/triangleTextured.vert': triangleTexturedVert,
            'src/triangleTextured.frag': triangleTexturedFrag,
        },
        triangle: {
            index: triangle,
            'src/triangle.vert': triangleVert,
            'src/triangle.frag': triangleFrag,
            'src/triangle.wgsl': triangleWgsl,
        },
    },
};

const normalizeExampleDataEntry = (categoryExample: ExampleDataEntry | string): Required<ExampleDataEntry> =>
{
    const defaults = {
        hide: false,
        usesWebWorkerLibrary: false,
    };

    if (typeof categoryExample === 'string')
    {
        return {
            ...defaults,
            name: categoryExample,
        };
    }

    return {
        ...defaults,
        ...categoryExample,
    };
};

const entries = Object.entries(examplesData as ExamplesJsonType).reduce(
    (directoryAcc, [categoryKey, categoryExamples]) => ({
        ...directoryAcc,
        [categoryKey]: categoryExamples.reduce((categoryAcc, categoryExampleOrString) =>
        {
            const categoryExample = normalizeExampleDataEntry(categoryExampleOrString);
            const { name: categoryName, hide, usesWebWorkerLibrary } = categoryExample;

            return {
                ...categoryAcc,
                [categoryName]: {
                    source: examplesSource[categoryKey][categoryName],
                    hide,
                    usesWebWorkerLibrary,
                },
            };
        }, {} as CategoryDataType),
    }),
    {} as ExamplesDataType,
);

const options = Object.entries(examplesData as ExamplesJsonType).map(([folderKey, folderEntries]) =>
{
    const options = folderEntries.reduce((acc, exampleDataEntry) =>
    {
        const { name: exampleKey, hide } = normalizeExampleDataEntry(exampleDataEntry);

        if (hide)
        {
            return acc;
        }

        return acc.concat({
            value: `${folderKey}.${exampleKey}`,
            label: camelCaseToSentenceCase(exampleKey),
        });
    }, [] as Option[]);

    return {
        label: camelCaseToSentenceCase(folderKey),
        options,
    };
});

export default { entries, options };
